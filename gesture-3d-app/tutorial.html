<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesture 3D Sculptor - Interactive Tutorial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            overflow: hidden;
            color: white;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #video-container {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 320px;
            height: 240px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 3px solid rgba(102, 126, 234, 0.5);
            z-index: 10;
        }

        #video {
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
            display: block;
        }

        #hand-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .tutorial-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
        }

        .tutorial-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .tutorial-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 50px;
            max-width: 700px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .tutorial-card h1 {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tutorial-card p {
            font-size: 18px;
            line-height: 1.8;
            color: #ccc;
            margin-bottom: 30px;
        }

        .tutorial-steps {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .step {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .step:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .step-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .step-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #667eea;
        }

        .step-description {
            font-size: 14px;
            color: #aaa;
        }

        .btn-start {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
        }

        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }

        .step-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            padding: 40px 60px;
            border-radius: 20px;
            border: 2px solid rgba(102, 126, 234, 0.5);
            z-index: 50;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.5s;
        }

        .step-indicator.show {
            opacity: 1;
        }

        .step-indicator h2 {
            font-size: 36px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .step-indicator p {
            font-size: 18px;
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .step-indicator .gesture-demo {
            font-size: 80px;
            margin: 20px 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }

        .btn-next, .btn-skip {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s;
        }

        .btn-next {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
        }

        .btn-next:hover, .btn-skip:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
        }

        .loading h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .completion-card {
            text-align: center;
        }

        .completion-card h2 {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .completion-card .icon {
            font-size: 120px;
            margin-bottom: 20px;
            animation: celebrate 1s ease-in-out;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-10deg); }
            75% { transform: scale(1.2) rotate(10deg); }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .feature-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .feature-item .icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .feature-item .title {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <h1>üé® Gesture 3D Sculptor</h1>
        <div class="spinner"></div>
        <p style="margin-top: 20px;">Loading tutorial...</p>
    </div>

    <div id="container">
        <div id="canvas-container"></div>

        <div id="video-container">
            <video id="video" autoplay playsinline></video>
            <canvas id="hand-canvas"></canvas>
        </div>

        <!-- Welcome Screen -->
        <div class="tutorial-overlay" id="welcome-screen">
            <div class="tutorial-card">
                <h1>üé® Welcome to Gesture 3D Sculptor!</h1>
                <p>
                    Transform your hands into 3D modeling tools! This interactive tutorial
                    will teach you how to create, manipulate, and customize 3D objects using
                    just your webcam and hand gestures.
                </p>

                <div class="tutorial-steps">
                    <div class="step">
                        <div class="step-icon">ü§è</div>
                        <div class="step-title">Pinch to Scale</div>
                        <div class="step-description">
                            Bring your thumb and index finger together to scale objects
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-icon">‚úã</div>
                        <div class="step-title">Drag to Rotate</div>
                        <div class="step-description">
                            Open your palm and move to rotate objects in 3D space
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-icon">‚úä</div>
                        <div class="step-title">Fist to Reset</div>
                        <div class="step-description">
                            Make a fist to reset rotation to default position
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-icon">‚úåÔ∏è</div>
                        <div class="step-title">Peace for Auto-Rotate</div>
                        <div class="step-description">
                            Show peace sign to toggle automatic rotation
                        </div>
                    </div>
                </div>

                <button class="btn-start" onclick="startTutorial()">
                    Start Tutorial ‚Üí
                </button>
                <br><br>
                <button class="btn-skip" onclick="skipTutorial()">
                    Skip Tutorial
                </button>
            </div>
        </div>

        <!-- Tutorial Steps -->
        <div class="step-indicator" id="tutorial-step">
            <div id="step-content"></div>
            <div style="margin-top: 30px;">
                <button class="btn-next" onclick="nextStep()">Next ‚Üí</button>
                <button class="btn-skip" onclick="skipTutorial()">Skip</button>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

    <script>
        // ==================== TUTORIAL STEPS ====================
        const tutorialSteps = [
            {
                title: 'üëã Step 1: Hand Detection',
                description: 'Make sure your hand is visible in the camera feed. The app will highlight your hand with green lines when detected.',
                gesture: 'üëã',
                duration: 5000
            },
            {
                title: 'ü§è Step 2: Pinch Gesture',
                description: 'Bring your thumb and index finger together to make a pinch. This gesture lets you scale the 3D object. Try pinching and moving your hand closer or farther from the camera!',
                gesture: 'ü§è',
                duration: 8000
            },
            {
                title: '‚úã Step 3: Open Palm Drag',
                description: 'Open your palm wide and move your hand around. This will rotate the 3D object. Try moving in different directions!',
                gesture: '‚úã',
                duration: 8000
            },
            {
                title: '‚úä Step 4: Fist Reset',
                description: 'Make a fist to reset the rotation. This is useful when you want to return to the default view.',
                gesture: '‚úä',
                duration: 5000
            },
            {
                title: '‚úåÔ∏è Step 5: Peace Sign',
                description: 'Show a peace sign (index and middle fingers up) to toggle auto-rotation mode. The object will spin automatically!',
                gesture: '‚úåÔ∏è',
                duration: 5000
            },
            {
                title: 'üé® Step 6: Customization',
                description: 'Look at the left panel! You can change models, colors, materials, and effects. Try clicking different options to see what happens!',
                gesture: 'üëÜ',
                duration: 6000
            },
            {
                title: 'üéâ Tutorial Complete!',
                description: 'You\'re now ready to create amazing 3D art with your hands! Explore all the features and have fun!',
                gesture: 'üéâ',
                isComplete: true
            }
        ];

        let currentStep = 0;
        let tutorialActive = false;

        // ==================== THREE.JS SETUP ====================
        let scene, camera, renderer, currentModel, particles;
        let handResults = null;
        let previousPinchDistance = null;
        let previousHandPosition = null;
        let autoRotate = false;

        function initThreeJS() {
            const container = document.getElementById('canvas-container');

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);

            camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.z = 5;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const pointLight1 = new THREE.PointLight(0x667eea, 1.5, 100);
            pointLight1.position.set(5, 5, 5);
            scene.add(pointLight1);

            const pointLight2 = new THREE.PointLight(0x764ba2, 1.5, 100);
            pointLight2.position.set(-5, -5, 5);
            scene.add(pointLight2);

            // Create model
            const geometry = new THREE.TorusKnotGeometry(1, 0.3, 100, 16);
            const material = new THREE.MeshStandardMaterial({
                color: 0x667eea,
                metalness: 0.7,
                roughness: 0.2,
                emissive: 0x667eea,
                emissiveIntensity: 0.3
            });
            currentModel = new THREE.Mesh(geometry, material);
            scene.add(currentModel);

            // Particles
            createParticles();

            window.addEventListener('resize', onWindowResize, false);
        }

        function createParticles() {
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(1000 * 3);

            for (let i = 0; i < 1000 * 3; i++) {
                positions[i] = (Math.random() - 0.5) * 20;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            const material = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.05,
                transparent: true,
                opacity: 0.6,
                blending: THREE.AdditiveBlending
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // ==================== MEDIAPIPE HANDS ====================
        const videoElement = document.getElementById('video');
        const canvasElement = document.getElementById('hand-canvas');
        const canvasCtx = canvasElement.getContext('2d');

        function onResults(results) {
            handResults = results;

            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            if (results.multiHandLandmarks) {
                for (const landmarks of results.multiHandLandmarks) {
                    drawConnectors(canvasCtx, landmarks, HANDS_CONNECTIONS, {
                        color: '#00FF00',
                        lineWidth: 3
                    });
                    drawLandmarks(canvasCtx, landmarks, {
                        color: '#FF0000',
                        lineWidth: 2,
                        radius: 4
                    });
                }
            }

            canvasCtx.restore();
            processGestures(results);
        }

        const hands = new Hands({
            locateFile: (file) => {
                return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
            }
        });

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        hands.onResults(onResults);

        const camera_hands = new Camera(videoElement, {
            onFrame: async () => {
                await hands.send({ image: videoElement });
            },
            width: 640,
            height: 480
        });

        // ==================== GESTURE PROCESSING ====================
        function processGestures(results) {
            if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) {
                previousPinchDistance = null;
                previousHandPosition = null;
                return;
            }

            const landmarks = results.multiHandLandmarks[0];
            const thumbTip = landmarks[4];
            const indexTip = landmarks[8];
            const pinchDistance = Math.sqrt(
                Math.pow(thumbTip.x - indexTip.x, 2) +
                Math.pow(thumbTip.y - indexTip.y, 2)
            );

            const isPinching = pinchDistance < 0.05;

            if (isPinching && currentModel) {
                if (previousPinchDistance !== null) {
                    const scaleFactor = pinchDistance / previousPinchDistance;
                    currentModel.scale.multiplyScalar(scaleFactor);
                    currentModel.scale.clampScalar(0.3, 5);
                }
                previousPinchDistance = pinchDistance;
            } else {
                previousPinchDistance = null;

                const palmBase = landmarks[0];
                const middleTip = landmarks[12];
                const handOpenness = Math.sqrt(
                    Math.pow(palmBase.x - middleTip.x, 2) +
                    Math.pow(palmBase.y - middleTip.y, 2)
                );

                if (handOpenness > 0.2 && currentModel) {
                    const currentPosition = { x: palmBase.x, y: palmBase.y };

                    if (previousHandPosition) {
                        const deltaX = (currentPosition.x - previousHandPosition.x) * 5;
                        const deltaY = (currentPosition.y - previousHandPosition.y) * 5;

                        currentModel.rotation.y += deltaX;
                        currentModel.rotation.x += deltaY;
                    }

                    previousHandPosition = currentPosition;
                } else {
                    previousHandPosition = null;
                }
            }

            if (detectFist(landmarks)) {
                currentModel.rotation.set(0, 0, 0);
            }

            if (detectPeaceSign(landmarks)) {
                autoRotate = !autoRotate;
            }
        }

        function detectFist(landmarks) {
            const palmBase = landmarks[0];
            let totalDist = 0;
            for (let i = 4; i <= 20; i += 4) {
                const tip = landmarks[i];
                totalDist += Math.sqrt(
                    Math.pow(tip.x - palmBase.x, 2) +
                    Math.pow(tip.y - palmBase.y, 2)
                );
            }
            return totalDist / 5 < 0.15;
        }

        function detectPeaceSign(landmarks) {
            const palmBase = landmarks[0];
            const indexTip = landmarks[8];
            const middleTip = landmarks[12];
            const ringTip = landmarks[16];
            const pinkyTip = landmarks[20];

            const indexUp = indexTip.y < palmBase.y;
            const middleUp = middleTip.y < palmBase.y;
            const ringDown = ringTip.y > palmBase.y - 0.05;
            const pinkyDown = pinkyTip.y > palmBase.y - 0.05;

            return indexUp && middleUp && ringDown && pinkyDown;
        }

        // ==================== TUTORIAL FUNCTIONS ====================
        function startTutorial() {
            document.getElementById('welcome-screen').classList.add('hidden');
            tutorialActive = true;
            currentStep = 0;
            showStep(currentStep);
        }

        function showStep(stepIndex) {
            const step = tutorialSteps[stepIndex];
            const stepElement = document.getElementById('tutorial-step');
            const contentElement = document.getElementById('step-content');
            const progressElement = document.getElementById('progress');

            if (step.isComplete) {
                contentElement.innerHTML = `
                    <div class="completion-card">
                        <div class="icon">${step.gesture}</div>
                        <h2>${step.title}</h2>
                        <p>${step.description}</p>
                        <div class="feature-grid">
                            <div class="feature-item">
                                <div class="icon">üé®</div>
                                <div class="title">6 Models</div>
                            </div>
                            <div class="feature-item">
                                <div class="icon">üåà</div>
                                <div class="title">Custom Colors</div>
                            </div>
                            <div class="feature-item">
                                <div class="icon">‚ú®</div>
                                <div class="title">Effects</div>
                            </div>
                            <div class="feature-item">
                                <div class="icon">üì∏</div>
                                <div class="title">Screenshots</div>
                            </div>
                            <div class="feature-item">
                                <div class="icon">üíæ</div>
                                <div class="title">Export</div>
                            </div>
                            <div class="feature-item">
                                <div class="icon">üé≤</div>
                                <div class="title">Randomize</div>
                            </div>
                        </div>
                        <button class="btn-start" onclick="completeTutorial()">
                            Start Creating! üöÄ
                        </button>
                    </div>
                `;
            } else {
                contentElement.innerHTML = `
                    <h2>${step.title}</h2>
                    <div class="gesture-demo">${step.gesture}</div>
                    <p>${step.description}</p>
                `;
            }

            const progress = ((stepIndex + 1) / tutorialSteps.length) * 100;
            progressElement.style.width = progress + '%';

            stepElement.classList.add('show');

            if (!step.isComplete && step.duration) {
                setTimeout(() => {
                    if (tutorialActive && currentStep === stepIndex) {
                        nextStep();
                    }
                }, step.duration);
            }
        }

        function nextStep() {
            const stepElement = document.getElementById('tutorial-step');
            stepElement.classList.remove('show');

            setTimeout(() => {
                currentStep++;
                if (currentStep < tutorialSteps.length) {
                    showStep(currentStep);
                } else {
                    completeTutorial();
                }
            }, 500);
        }

        function skipTutorial() {
            tutorialActive = false;
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('tutorial-step').classList.remove('show');
        }

        function completeTutorial() {
            tutorialActive = false;
            document.getElementById('tutorial-step').classList.remove('show');
            // Could redirect to main app or enable full features
            window.location.href = 'index.html';
        }

        // ==================== ANIMATION LOOP ====================
        function animate() {
            requestAnimationFrame(animate);

            if (currentModel) {
                if (autoRotate || !tutorialActive) {
                    currentModel.rotation.y += 0.01;
                    currentModel.rotation.x += 0.005;
                }
            }

            if (particles) {
                particles.rotation.y += 0.001;
            }

            renderer.render(scene, camera);
        }

        // ==================== INITIALIZATION ====================
        async function init() {
            try {
                canvasElement.width = 320;
                canvasElement.height = 240;

                initThreeJS();
                await camera_hands.start();

                document.getElementById('loading').style.display = 'none';
                animate();
            } catch (error) {
                console.error('Initialization error:', error);
                alert('Error initializing. Please allow camera access.');
            }
        }

        init();
    </script>
</body>
</html>
